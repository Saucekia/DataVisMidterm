<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Colors of Manhattan — Landing</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css">


  <style>
    :root{
      --bg:#f6f7f9; --panel:#ffffff; --border:#e3e6eb;
      --ink:#1b1d21; --muted:#5e6470;
      --accent:#0e7a53; --accent-ink:#ffffff; --accent-weak:#eaf5f1;
    }
    html, body{
      height:100%; margin:0; background:var(--bg); color:var(--ink);
      font:16px/1.55 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
    }

    
    .stage{
      position:relative; height:100vh; width:100%;
      overflow:hidden; background:var(--panel);
      border-bottom:1px solid var(--border);
    }

    
    .stripes{
      position:absolute; inset:0;
      display:flex; 
    }
    .stripe{
      flex:1 1 auto; transform:translateY(8%); opacity:0;
      animation: rise .9s ease forwards;
      will-change: transform, opacity, filter;
      filter:saturate(1.02) contrast(1.02);
    }
    
    .stripe:nth-child(4n+1){ animation-delay:.00s; }
    .stripe:nth-child(4n+2){ animation-delay:.06s; }
    .stripe:nth-child(4n+3){ animation-delay:.12s; }
    .stripe:nth-child(4n+4){ animation-delay:.18s; }

    @keyframes rise{
      from{ transform:translateY(8%); opacity:0; }
      to  { transform:translateY(0);   opacity:1; }
    }

    
    .overlay{
      position:absolute; inset:0;
      display:grid; place-items:center;
      pointer-events:none; 
    }
    .card{
      pointer-events:auto;
      background:rgba(255,255,255,.86);
      backdrop-filter:saturate(120%) blur(6px);
      border:1px solid var(--border);
      border-radius:20px;
      box-shadow:0 18px 50px rgba(0,0,0,.12);
      padding:24px 22px 20px;
      max-width:780px; width:min(92%, 780px);
      text-align:center;
    }
    h1{
      margin:0 0 8px; font-size:32px; line-height:1.15; font-weight:900; letter-spacing:.3px; color:var(--accent);
    }
    p.lead{
      margin:0 0 14px; color:var(--muted); font-size:15px;
    }

    .actions{
      margin-top:10px; display:flex; flex-wrap:wrap; justify-content:center; gap:10px;
    }
    .btn{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 14px; border-radius:12px; font-weight:800; cursor:pointer;
      border:1px solid var(--border); background:var(--panel); color:var(--ink);
      text-decoration:none;
      transition: box-shadow .15s ease, transform .05s ease;
    }
    .btn:hover{ box-shadow:0 8px 20px rgba(0,0,0,.08); }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{ background:var(--accent); color:var(--accent-ink); border-color:transparent; }
    .btn.ghost{ color:var(--accent); background:var(--accent-weak); border-color:#d7ece4; }

   
    .mode{
      margin-top:12px;
      display:inline-flex; align-items:center; gap:10px;
      background:rgba(255,255,255,.9); border:1px solid var(--border);
      border-radius:999px; padding:6px 10px;
    }
    .label{ color:var(--muted); font-size:12px; }
    .tag{ font-weight:800; font-size:12px; color:var(--muted); }
    .tag.right{ color:var(--accent); }

    .toggle{
      position:relative; width:74px; height:32px; background:#eef4f1;
      border:1px solid var(--border); border-radius:999px; cursor:pointer; flex:0 0 auto;
    }
    .toggle input{ display:none; }
    .knob{
      position:absolute; top:2px; left:2px; width:28px; height:28px; background:#fff; border-radius:50%;
      transition:transform .18s ease, background .18s ease, box-shadow .18s ease;
      box-shadow:0 2px 6px rgba(0,0,0,.12);
    }
    .toggle input:checked + .knob{
      transform:translateX(42px); background:var(--accent);
      box-shadow:0 3px 10px rgba(14,122,83,.4);
    }

   
    .fadeTop, .fadeBottom{
      position:absolute; left:0; right:0; height:120px; pointer-events:none;
    }
    .fadeTop{ top:0; background:linear-gradient(to bottom, rgba(255,255,255,.65), transparent); }
    .fadeBottom{ bottom:0; background:linear-gradient(to top, rgba(255,255,255,.5), transparent); }

    @media (max-width:560px){
      h1{ font-size:26px; }
      .mode .tag{ display:none; }
    }
  </style>


</head>
<body>
  <main class="stage" aria-label="Colors of Manhattan landing">
    <div id="stripes" class="stripes" aria-hidden="true"></div>

   
    <div class="fadeTop"></div>
    <div class="fadeBottom"></div>

   
    <div class="overlay">
      <div class="card" role="dialog" aria-label="Project intro">
        <h1>Manhattan Colors </h1>
        <p class="lead">
          Each neighborhood shape is filled with its average color.
          Explore the map and maybe play the game!
        </p>

        <div class="mode" title="Toggle vibrant / true colors">
          <span class="label">Color mode</span>
          <span class="tag left">True</span>
          <label class="toggle">
            <input id="modeToggle" type="checkbox" />
            <span class="knob"></span>
          </label>
          <span class="tag right">Vibrant</span>
        </div>

        <div class="actions">
          <a class="btn primary" href="map.html">Open the Map</a>
          <a class="btn ghost" href="guess.html">Play the Game</a>
        </div>
      </div>
    </div>
  </main>

  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script>
  (async function(){
  
    const CSV = "manhattan_colors.csv";
    const BOOST_VIBRANCE = 135; 
    const BOOST_CONTRAST = 118;
    const START_VIBRANT = true; //default toggle state
  

  
    const clamp=(x,a,b)=>Math.min(b,Math.max(a,x));
    function hexToRgb(hex){ const m=/^#?([0-9a-f]{6})$/i.exec(String(hex||'').trim()); if(!m) return {r:119,g:122,b:128}; const n=parseInt(m[1],16); return { r:(n>>16)&255, g:(n>>8)&255, b:n&255 };}
    function rgbToHex(r,g,b){ return "#" + [r,g,b].map(v=>clamp(Math.round(v),0,255).toString(16).padStart(2,"0")).join(""); }
    function rgbToHsl(r,g,b){ r/=255; g/=255; b/=255; const mx=Math.max(r,g,b), mn=Math.min(r,g,b); let h,s,l=(mx+mn)/2, d=mx-mn;
      if(d===0){h=0;s=0;} else { s = l>0.5 ? d/(2-mx-mn) : d/(mx+mn); switch(mx){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break;} h/=6; }
      return {h,s,l}; }
    function hslToRgb(h,s,l){ const hue2rgb=(p,q,t)=>{ if(t<0)t+=1; if(t>1)t-=1; if(t<1/6)return p+(q-p)*6*t; if(t<1/2)return q; if(t<2/3)return p+(q-p)*(2/3-t)*6; return p; };
      let r,g,b; if(s===0){r=g=b=l;} else { const q=l<0.5?l*(1+s):l+s-l*s; const p=2*l-q; r=hue2rgb(p,q,h+1/3); g=hue2rgb(p,q,h); b=hue2rgb(p,q,h-1/3); }
      return { r:Math.round(r*255), g:Math.round(g*255), b:Math.round(b*255) }; }
    function adjustHex(hex, vibPct, conPct){
      const {r,g,b}=hexToRgb(hex), c=conPct/100;
      const rc=clamp((r-128)*c+128,0,255), gc=clamp((g-128)*c+128,0,255), bc=clamp((b-128)*c+128,0,255);
      let {h,s,l}=rgbToHsl(rc,gc,bc); const vib=vibPct/100, add=(vib-1)*(1-s); s=clamp(s+add,0,1);
      const {r:R,g:G,b:B}=hslToRgb(h,s,l);
      return rgbToHex(R,G,B);
    }

    
    let rows = await d3.csv(CSV);
    rows = rows.map(r=>{
      const code = (r.nta2020||"").toUpperCase().trim();
      const name = (r.ntaname||r.name||"").trim();
      const hex  = (r.hex||"#777a80").trim();
      if(!hex) return null;
      const {r:rr,g:gg,b:bb} = hexToRgb(hex);
      const {h} = rgbToHsl(rr,gg,bb);
      return { code, name, hex, boosted: adjustHex(hex, BOOST_VIBRANCE, BOOST_CONTRAST), hue: h ?? 0 };
    }).filter(Boolean);

    if (!rows.length){
     
      const stripes = document.getElementById("stripes");
      for (let i=0;i<24;i++){
        const d = document.createElement("div");
        d.className = "stripe";
        d.style.background = `hsl(${(i*15)%360} 20% 85%)`;
        stripes.appendChild(d);
      }
      console.warn("No rows loaded from CSV; showing fallback stripes.");
      return;
    }

   
    rows.sort((a,b)=>a.hue - b.hue);

    
    const stripes = document.getElementById("stripes");
    const frag = document.createDocumentFragment();
    rows.forEach((r,i)=>{
      const d = document.createElement("div");
      d.className = "stripe";
      d.style.background = r.boosted;     // start vibrant
      d.style.animationDelay = (i % 12) * 0.04 + "s"; // softer stagger
      d.setAttribute("title", r.name ? `${r.name} — ${r.hex}` : r.hex);
      d.dataset.base = r.hex;
      d.dataset.boost = r.boosted;
      frag.appendChild(d);
    });
    stripes.appendChild(frag);

    
    const modeToggle = document.getElementById("modeToggle");
    modeToggle.checked = START_VIBRANT;
    function applyMode(){
      const boosted = modeToggle.checked;
      document.querySelectorAll(".stripe").forEach(s=>{
        s.style.background = boosted ? s.dataset.boost : s.dataset.base;
      });
    }
    modeToggle.addEventListener("change", applyMode);
    applyMode();

    
    window.addEventListener("keydown", (e)=>{
      if (e.key.toLowerCase() === "m"){
        modeToggle.checked = !modeToggle.checked;
        applyMode();
      } else if (e.key === "Enter"){
        window.location.href = "map.html";
      }
    });
  })();
  </script>
</body>
</html>
